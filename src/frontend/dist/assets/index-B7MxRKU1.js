import{j as e,r}from"./react-DHqCc_uR.js";import{c as At}from"./react-dom-CuuQ5-yA.js";import{O as Te,u as Ft,N as Et,a as Pe,b as ze,B as Mt,R as Ot,c as Ie}from"./react-router-C1rnM6mN.js";import{T as Ve,I as Tt,S as Be,a as Ue,P as Pt,C as Ye,V as zt,L as qe,b as He,c as Vt,d as Bt,e as _e,R as Ut,f as Yt,g as Je,h as Ge,i as Qe,j as We,k as qt,O as Ke,l as Ht,m as Xe,n as _t,o as Ze,D as et,p as Jt,q as tt}from"./@radix-ui-ByqPd-ZU.js";import{c as Gt}from"./clsx-B-dksMZM.js";import{t as Qt}from"./tailwind-merge-D696Ktp4.js";import{C as st,a as Wt,b as Kt,c as Xt,U as Se,X as Zt,L as es,d as ts,S as ss,M as as,e as at,f as rs,g as ns,F as os,I as Ae,h as ls,i as is,j as cs,D as ds,k as ms,P as us,l as xs}from"./lucide-react-DQIkpxpQ.js";import{c as De}from"./class-variance-authority-Dp3B9jqt.js";import{j as Fe}from"./jsqr-fyFDz0PP.js";import{V as M,O as hs}from"./react-hot-toast-B7KtrtSH.js";import{a as Le}from"./axios-C88pvD_q.js";import{u as ps,F as fs,C as gs,b as rt}from"./react-hook-form-Uz6ZXrja.js";import{z as W}from"./zod-mSkvzYyn.js";import{t as nt}from"./@hookform-B-JUM-j1.js";import{r as bs,u as ie,w as js}from"./xlsx-D8wqrsip.js";import{G as Ns}from"./@google-Cyre3K_c.js";import"./cookie-Ddo6p1Qn.js";import"./scheduler-DYLXRpC5.js";import"./@floating-ui-DEJPq-br.js";import"./aria-hidden-DQ5UC2Eg.js";import"./react-remove-scroll-BlIxM1M_.js";import"./tslib-CDuPK5Eb.js";import"./react-remove-scroll-bar-4iB6bYdv.js";import"./react-style-singleton-CMA6-1ZH.js";import"./get-nonce-C-Z93AgS.js";import"./use-sidecar-etjUjgc1.js";import"./use-callback-ref-BKF_JUQ0.js";import"./goober-np-fLvOt.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const l of n)if(l.type==="childList")for(const m of l.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function a(n){const l={};return n.integrity&&(l.integrity=n.integrity),n.referrerPolicy&&(l.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?l.credentials="include":n.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(n){if(n.ep)return;n.ep=!0;const l=a(n);fetch(n.href,l)}})();const vs=()=>e.jsxs("main",{className:"w-full h-full",children:[e.jsx(Te,{}),e.jsx("div",{className:"mt-32"})]}),ot=({children:t})=>e.jsx("div",{className:"flex flex-col min-h-screen  items-center justify-center",children:e.jsx("div",{className:"container mx-auto max-w-6xl px-4",children:t})}),lt=({sidebar:t,content:s})=>e.jsxs("div",{className:"flex flex-1 container mx-auto",children:[t,e.jsx("main",{className:"flex-1 ml-4 rounded-xl mt-4 ring-1 ring-secondary p-4",children:s})]}),Re=({children:t,variant:s="default",className:a=""})=>{const o={default:"text-base",title:"font-bold text-xl",subtitle:"text-sm text-gray-500",label:"font-medium text-sm text-gray-500"};return e.jsx("span",{className:`${o[s]} ${a}`,children:t})},ys=()=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("img",{width:40,height:40,src:"/images/logo.png",alt:""}),e.jsx(Re,{variant:"title",children:"Exam Results"})]});function x(...t){return Qt(Gt(t))}const ee=Ut,te=Yt,K=r.forwardRef(({className:t,children:s,...a},o)=>e.jsxs(Ve,{ref:o,className:x("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-full border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...a,children:[s,e.jsx(Tt,{asChild:!0,children:e.jsx(st,{className:"h-4 w-4 opacity-50"})})]}));K.displayName=Ve.displayName;const it=r.forwardRef(({className:t,...s},a)=>e.jsx(Be,{ref:a,className:x("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Wt,{className:"h-4 w-4"})}));it.displayName=Be.displayName;const ct=r.forwardRef(({className:t,...s},a)=>e.jsx(Ue,{ref:a,className:x("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(st,{className:"h-4 w-4"})}));ct.displayName=Ue.displayName;const X=r.forwardRef(({className:t,children:s,position:a="popper",...o},n)=>e.jsx(Pt,{children:e.jsxs(Ye,{ref:n,className:x("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...o,children:[e.jsx(it,{}),e.jsx(zt,{className:x("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(ct,{})]})}));X.displayName=Ye.displayName;const Ss=r.forwardRef(({className:t,...s},a)=>e.jsx(qe,{ref:a,className:x("px-2 py-1.5 text-sm font-semibold",t),...s}));Ss.displayName=qe.displayName;const B=r.forwardRef(({className:t,children:s,...a},o)=>e.jsxs(He,{ref:o,className:x("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(Vt,{children:e.jsx(Kt,{className:"h-4 w-4"})})}),e.jsx(Bt,{children:s})]}));B.displayName=He.displayName;const ws=r.forwardRef(({className:t,...s},a)=>e.jsx(_e,{ref:a,className:x("-mx-1 my-1 h-px bg-muted",t),...s}));ws.displayName=_e.displayName;const Cs=({selectedYear:t,setSelectedYear:s})=>e.jsxs(ee,{value:t,onValueChange:s,children:[e.jsx(K,{className:"w-36",children:e.jsx(te,{placeholder:"Year"})}),e.jsxs(X,{children:[e.jsx(B,{value:"2025",children:"2025"}),e.jsx(B,{value:"2024",children:"2024"}),e.jsx(B,{value:"2023",children:"2023"}),e.jsx(B,{value:"2022",children:"2022"}),e.jsx(B,{value:"2021",children:"2021"})]})]}),_=({icon:t,size:s=4,className:a=""})=>e.jsx(t,{className:`h-${s} w-${s} ${a}`}),ks=De("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground  hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground  hover:bg-destructive/90",outline:"border border-input bg-background  hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground  hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),z=r.forwardRef(({className:t,variant:s,size:a,asChild:o=!1,...n},l)=>{const m=o?Je:"button";return e.jsx(m,{className:x(ks({variant:s,size:a,className:t})),ref:l,...n})});z.displayName="Button";const se=r.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:x("rounded-xl border bg-card text-card-foreground ",t),...s}));se.displayName="Card";const ae=r.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:x("flex flex-col space-y-1.5 p-6",t),...s}));ae.displayName="CardHeader";const re=r.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:x("font-semibold leading-none tracking-tight",t),...s}));re.displayName="CardTitle";const Ds=r.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:x("text-sm text-muted-foreground",t),...s}));Ds.displayName="CardDescription";const ne=r.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:x("p-6 pt-0",t),...s}));ne.displayName="CardContent";const dt=r.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:x("flex items-center p-6 pt-0",t),...s}));dt.displayName="CardFooter";const Ls=qt,mt=r.forwardRef(({className:t,...s},a)=>e.jsx(Ge,{ref:a,className:x("inline-flex h-10 gap-4 items-center justify-center rounded-md  p-1 text-muted-foreground",t),...s}));mt.displayName=Ge.displayName;const we=r.forwardRef(({className:t,...s},a)=>e.jsx(Qe,{ref:a,className:x("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-black data-[state=active]:text-white",t),...s}));we.displayName=Qe.displayName;const Ce=r.forwardRef(({className:t,...s},a)=>e.jsx(We,{ref:a,className:x("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));Ce.displayName=We.displayName;const Rs=({onScanSuccess:t})=>{const[s,a]=r.useState("camera"),[o,n]=r.useState(!1),[l,m]=r.useState(null),b=r.useRef(null),D=r.useRef(null),N=r.useRef(null),F=async()=>{try{m(null);const c=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});b.current&&(b.current.srcObject=c,N.current=c,n(!0),requestAnimationFrame(I))}catch(c){m("Camera access denied or not available."),console.error("Error accessing camera:",c)}},y=()=>{N.current&&(N.current.getTracks().forEach(c=>c.stop()),N.current=null),n(!1)},I=()=>{const c=b.current,d=D.current,S=d==null?void 0:d.getContext("2d");if(S&&(c==null?void 0:c.readyState)===(c==null?void 0:c.HAVE_ENOUGH_DATA)){d.height=c==null?void 0:c.videoHeight,d.width=c==null?void 0:c.videoWidth,S==null||S.drawImage(c,0,0,d==null?void 0:d.width,d==null?void 0:d.height);const w=S.getImageData(0,0,d==null?void 0:d.width,d==null?void 0:d.height),A=Fe(w.data,w.width,w.height,{inversionAttempts:"dontInvert"});if(A)try{const f=JSON.parse(A.data);if(g(f)){y(),t(f);return}}catch(f){M.error(f instanceof Error?f.message:String(f))}requestAnimationFrame(I)}else requestAnimationFrame(I)},L=c=>{var w;const d=(w=c.target.files)==null?void 0:w[0];if(!d)return;m(null);const S=new FileReader;S.onload=A=>{var O;const f=new Image;f.onload=()=>{const T=document.createElement("canvas"),V=T.getContext("2d");if(!V){m("Could not process image");return}T.width=f.width,T.height=f.height,V.drawImage(f,0,0);const U=V.getImageData(0,0,T.width,T.height),J=Fe(U.data,U.width,U.height,{inversionAttempts:"dontInvert"});if(J)try{const H=JSON.parse(J.data);if(g(H)){t(H);return}m("Invalid QR code format")}catch{m("Invalid QR code content")}else m("No QR code found in image")},f.src=(O=A.target)==null?void 0:O.result},S.readAsDataURL(d)},g=c=>typeof c=="object"&&typeof c.token=="string"&&typeof c.number=="string"&&typeof c.isExpired=="boolean";return r.useEffect(()=>(s==="camera"?F():y(),()=>{y()}),[s]),e.jsxs(se,{className:"w-full max-w-md mx-auto",children:[e.jsx(ae,{children:e.jsx(re,{children:"Scan QR Code"})}),e.jsxs(Ls,{value:s,onValueChange:a,children:[e.jsxs(mt,{className:"grid w-full grid-cols-2",children:[e.jsxs(we,{value:"camera",children:[e.jsx(Xt,{className:"mr-2 h-4 w-4"})," Camera"]}),e.jsxs(we,{value:"upload",children:[e.jsx(Se,{className:"mr-2 h-4 w-4"})," Upload"]})]}),e.jsxs(ne,{className:"p-4",children:[e.jsx(Ce,{value:"camera",className:"mt-0",children:e.jsxs("div",{className:"relative aspect-video bg-muted rounded overflow-hidden",children:[e.jsx("video",{ref:b,className:"w-full h-full object-cover",autoPlay:!0,playsInline:!0}),e.jsx("canvas",{ref:D,className:"hidden"}),o&&e.jsx("div",{className:"absolute inset-0 border-2 border-primary pointer-events-none",children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"h-48 w-48 border-2 border-white border-dashed rounded-lg"})})})]})}),e.jsx(Ce,{value:"upload",className:"mt-0",children:e.jsxs("div",{className:"flex flex-col items-center justify-center p-6 border-2 border-dashed border-muted-foreground rounded-lg min-h-40",children:[e.jsx(Se,{className:"h-10 w-10 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-center text-sm text-muted-foreground mb-2",children:"Upload an image containing a QR code"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",id:"qr-file-input",onChange:L}),e.jsx(z,{variant:"outline",size:"sm",onClick:()=>{var c;return(c=document.getElementById("qr-file-input"))==null?void 0:c.click()},children:"Select File"})]})})]})]}),l&&e.jsx(dt,{className:"pt-0",children:e.jsx("p",{className:"text-sm text-destructive",children:l})})]})},me=Jt,$s=Ht,ut=r.forwardRef(({className:t,...s},a)=>e.jsx(Ke,{ref:a,className:x("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));ut.displayName=Ke.displayName;const oe=r.forwardRef(({className:t,children:s,...a},o)=>e.jsxs($s,{children:[e.jsx(ut,{}),e.jsxs(Xe,{ref:o,className:x("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[s,e.jsxs(_t,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Zt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));oe.displayName=Xe.displayName;const ue=({className:t,...s})=>e.jsx("div",{className:x("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});ue.displayName="DialogHeader";const xt=({className:t,...s})=>e.jsx("div",{className:x("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});xt.displayName="DialogFooter";const le=r.forwardRef(({className:t,...s},a)=>e.jsx(Ze,{ref:a,className:x("text-lg font-semibold leading-none tracking-tight",t),...s}));le.displayName=Ze.displayName;const ht=r.forwardRef(({className:t,...s},a)=>e.jsx(et,{ref:a,className:x("text-sm text-muted-foreground",t),...s}));ht.displayName=et.displayName;const pt=r.createContext(null),Is=()=>{const t=sessionStorage.getItem("userData");if(!t)return null;try{return JSON.parse(t)}catch{return null}},As=({children:t})=>{const[s,a]=r.useState(!1),[o,n]=r.useState(null),[l,m]=r.useState(!0),b=Ft();r.useEffect(()=>{D()},[]);const D=()=>{const I=Is();I&&(n(I),a(!0)),m(!1)},y={isAuthenticated:s,userData:o,login:(I,L)=>{const g={token:I,number:L};sessionStorage.setItem("userData",JSON.stringify(g)),n(g),a(!0),M.success("Logged in successfully"),b("/portal")},logout:async()=>{sessionStorage.removeItem("userData"),n(null),a(!1),M.success("Logged out successfully"),b("/")},loading:l};return e.jsx(pt.Provider,{value:y,children:!l&&t})},xe=()=>{const t=r.useContext(pt);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},Fs=()=>{const[t,s]=r.useState(!1),{login:a,logout:o,isAuthenticated:n}=xe(),l=m=>{if(m.isExpired){alert("This QR code has expired. Please use a valid code.");return}a(m.token,m.number),s(!1)};return n?e.jsxs(z,{variant:"outline",size:"sm",className:"flex rounded-full items-center bg-red-50 hover:bg-red-100 text-red-600 border-red-200",onClick:o,children:[e.jsx(_,{icon:es,className:"mr-2"}),"Logout"]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{variant:"outline",size:"sm",className:"flex rounded-full items-center",onClick:()=>s(!0),children:[e.jsx(_,{icon:ts,className:"mr-2"}),"Login"]}),e.jsx(me,{open:t,onOpenChange:s,children:e.jsxs(oe,{children:[e.jsx(le,{children:"Login with QR Code"}),e.jsx(Rs,{onScanSuccess:l})]})})]})},ft=({selectedYear:t,setSelectedYear:s})=>{const{isAuthenticated:a}=xe(),o=()=>new Date().toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),n=()=>{const l=new Date().getHours();return l>=6&&l<18?e.jsx(ss,{size:18,className:"text-amber-500 mr-2"}):e.jsx(as,{size:18,className:"text-indigo-400 mr-2"})};return e.jsx("header",{className:"bg-gray-150 border-b border-b-secondary shadow-none",children:e.jsxs("div",{className:"container mx-auto px-4 py-3 flex items-center justify-between",children:[e.jsx(ys,{}),e.jsxs("div",{className:"flex items-center space-x-4",children:[a?e.jsxs("div",{className:"flex items-center text-gray-700 italic font-sm",children:[n(),o()]}):e.jsx(Cs,{selectedYear:t,setSelectedYear:s}),e.jsx(Fs,{})]})]})})},he=r.forwardRef(({className:t,type:s,...a},o)=>e.jsx("input",{type:s,className:x("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base  transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:o,...a}));he.displayName="Input";const $e=({placeholder:t,value:s,onChange:a,onSearch:o=null})=>e.jsxs("div",{className:"flex w-full",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_,{icon:at,className:"absolute left-2 top-2.5 text-gray-500"}),e.jsx(he,{placeholder:t,className:"pl-8 rounded-full",value:s,onChange:n=>a(n.target.value)})]}),o&&e.jsx("div",{className:"ml-2",children:e.jsx(z,{className:"text-black",onClick:o,children:"Search"})})]}),Es=()=>{const[t,s]=r.useState(""),o=[{id:"locate",name:"Locate Students",path:"/portal/locate",icon:e.jsx(at,{size:18,className:"text-green-500"})},{id:"distributed",name:"Distributed Students List",path:"/portal/distributed",icon:e.jsx(ns,{size:18,className:"text-green-500"})}].filter(n=>n.name.toLowerCase().includes(t.toLowerCase()));return e.jsxs("aside",{className:"w-64 mt-4 rounded-xl bg-white p-4 ring-1 ring-secondary h-full",children:[e.jsx("div",{className:"mb-6",children:e.jsx($e,{placeholder:"Search options...",value:t,onChange:s})}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx(rs,{size:18,className:"mr-2 text-gray-700"}),e.jsx(Re,{variant:"label",children:"Admin Options"})]}),e.jsxs("div",{className:"flex flex-col space-y-1",children:[o.map(n=>e.jsxs(Et,{to:n.path,className:({isActive:l})=>`flex items-center p-2 rounded-md transition-colors ${l?"bg-primary text-black":"text-gray-700 hover:bg-gray-100"}`,children:[e.jsx("span",{className:"mr-2",children:n.icon}),n.name]},n.id)),e.jsx("div",{className:"flex-grow min-h-64"})]})]})]})},Ms=()=>{const[t,s]=r.useState("2024");return e.jsxs(ot,{children:[e.jsx(ft,{selectedYear:t,setSelectedYear:s}),e.jsx(lt,{sidebar:e.jsx(Es,{}),content:e.jsx(Te,{})})]})},pe=()=>e.jsx("div",{className:"flex items-center justify-center w-full",children:e.jsxs("div",{className:"relative w-10 h-10",children:[e.jsx("div",{className:"absolute w-6 h-6 border border-white rounded-full"}),e.jsx("div",{className:"absolute w-6 h-6 border border-[#854836] rounded-full border-t-transparent animate-spin"})]})}),k={background:"bg-[#F3F4F6]",text:{primary:"text-[#2C3E50]",secondary:"text-[#34495E]",muted:"text-[#7F8C8D]"},border:"border-[#BDC3C7]",accent:{primary:"bg-[#2980B9]"}},Os=({results:t,selectedYear:s,selectedLevel:a,loading:o=!1})=>e.jsxs("div",{className:`p-4 ${k.background} rounded-lg shadow-md`,children:[e.jsxs("div",{className:`border-b-2 pb-3 mb-4 ${k.border}`,children:[e.jsx("h2",{className:`text-2xl font-serif font-bold ${k.text.primary}`,children:"Examination Results"}),e.jsxs("p",{className:`text-sm ${k.text.secondary} mt-1`,children:[a," • ",s]})]}),o?e.jsx("div",{className:"p-8 flex justify-center",children:e.jsx(pe,{})}):t?e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`text-xl font-serif font-semibold ${k.text.primary}`,children:t.name}),e.jsxs("div",{className:`flex items-center space-x-2 ${k.text.muted} text-sm mt-1`,children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(_,{icon:os,size:4,className:"mr-1"}),t.registrationNumber]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:t.level})]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:`font-bold text-2xl ${k.text.primary}`,children:[t.totalMarks,e.jsx("span",{className:`block text-sm font-normal ${k.text.muted}`,children:"Total Marks"})]})})]}),e.jsx("div",{className:`border-t-2 pt-4 mt-4 ${k.border}`,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx(_,{icon:Ae,size:4,className:`mr-3 mt-1 ${k.text.secondary}`}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-serif font-semibold ${k.text.primary}`,children:"Allocated Combination"}),e.jsx("p",{className:`${k.text.secondary} text-sm`,children:t.allocatedCombinations})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx(_,{icon:Ae,size:4,className:`mr-3 mt-1 ${k.text.secondary}`}),e.jsxs("div",{children:[e.jsx("h4",{className:`font-serif font-semibold ${k.text.primary}`,children:"Assigned School"}),e.jsx("p",{className:`${k.text.secondary} text-sm`,children:t.assignedSchool})]})]})]})}),t.explanation&&e.jsxs("div",{className:`mt-4 p-4 rounded-lg ${k.background} border ${k.border}`,children:[e.jsx("h4",{className:`font-serif font-semibold mb-2 ${k.text.primary}`,children:"Explanation"}),e.jsx("p",{className:`${k.text.secondary} text-sm leading-relaxed`,children:t.explanation})]})]}):e.jsx("div",{className:`text-center ${k.text.muted} p-4`,children:"Your result will be displayed here"})]}),Ts=({selectedLevel:t,setSelectedLevel:s})=>e.jsx("div",{className:`border-b ${k.border} mb-4`,children:e.jsxs("div",{className:"flex",children:[e.jsx("button",{onClick:()=>s("P-Level"),className:`
          flex-1 py-2 px-4 
          font-serif 
          ${t==="P-Level"?`${k.accent.primary} text-white`:`${k.text.secondary} bg-transparent`}
          transition duration-300
        `,children:"Primary Level"}),e.jsx("button",{onClick:()=>s("O-Level"),className:`
          flex-1 py-2 px-4 
          font-serif 
          ${t==="O-Level"?`${k.accent.primary} text-white`:`${k.text.secondary} bg-transparent`}
          transition duration-300
        `,children:"O'Level"})]})}),Ps=De("relative w-full rounded-lg border border-gray-200 px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-gray-950 [&>svg~*]:pl-7 dark:border-gray-800 dark:[&>svg]:text-gray-50",{variants:{variant:{default:"bg-white text-gray-950 dark:bg-gray-950 dark:text-gray-50",destructive:"border-red-500/50 text-red-500 dark:border-red-500 [&>svg]:text-red-500 dark:border-red-900/50 dark:text-red-900 dark:dark:border-red-900 dark:[&>svg]:text-red-900"}},defaultVariants:{variant:"default"}}),gt=r.forwardRef(({className:t,variant:s,...a},o)=>e.jsx("div",{ref:o,role:"alert",className:x(Ps({variant:s}),t),...a}));gt.displayName="Alert";const zs=r.forwardRef(({className:t,...s},a)=>e.jsx("h5",{ref:a,className:x("mb-1 font-medium leading-none tracking-tight",t),...s}));zs.displayName="AlertTitle";const bt=r.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:x("text-sm [&_p]:leading-relaxed",t),...s}));bt.displayName="AlertDescription";const Vs=()=>e.jsxs(gt,{className:"mb-6",children:[e.jsx(_,{icon:ls,className:"h-4 w-4"}),e.jsx(bt,{children:"Please enter your registration number to view your examination results"})]}),Bs=({registrationNumber:t,setRegistrationNumber:s,handleSearch:a})=>e.jsx("div",{className:"mb-6  p-3 rounded-md ",children:e.jsx($e,{placeholder:"REG10000",value:t,onChange:s,onSearch:a})}),Us=({level:t,selectedLevel:s,onClick:a})=>e.jsx(z,{variant:s===t.id?"default":"ghost",className:"w-full text-black font-bold justify-start",onClick:()=>a(t.id),children:t.name}),Ys=({sidebarSearch:t,setSidebarSearch:s,selectedLevel:a,setSelectedLevel:o})=>{const l=[{id:"Primary",name:"Primary Level"},{id:"O'Level",name:"O'Level"}].filter(m=>m.name.toLowerCase().includes(t.toLowerCase()));return e.jsxs("aside",{className:"w-64 mt-4 rounded-xl bg-white p-4 ring-1 ring-secondary",children:[e.jsx("div",{className:"mb-6",children:e.jsx($e,{placeholder:"Search levels...",value:t,onChange:s})}),e.jsxs("div",{className:"mt-6",children:[e.jsx(Re,{variant:"label",className:"mb-2 block",children:"Choose Your Level"}),e.jsx("div",{className:"space-y-1",children:l.map(m=>e.jsx(Us,{level:m,selectedLevel:a,onClick:o},m.id))})]})]})},qs=()=>{const[t,s]=r.useState("2024"),[a,o]=r.useState("P-Level"),[n,l]=r.useState(""),[m,b]=r.useState(""),[D,N]=r.useState(!1),[F,y]=r.useState(null),[I,L]=r.useState(!1),[g,c]=r.useState(null),d=async()=>{var S,w;if(n){L(!0),c(null);try{const A=await Le.get(`http://bkyz2-fmaaa-aaaaa-qaaaq-cai.raw.localhost:4943/distributions/student/${n}`,{params:{year:t,level:a}});A.data.success?(y(A.data.data),N(!0)):(c(A.data.message||"No results found"),y(null))}catch(A){c(((w=(S=A.response)==null?void 0:S.data)==null?void 0:w.message)||A.message||"An unexpected error occurred"),y(null)}finally{L(!1)}}};return r.useEffect(()=>{y(null),N(!1),c(null)},[t,a]),e.jsxs(ot,{children:[e.jsx(ft,{selectedYear:t,setSelectedYear:s}),e.jsx(lt,{sidebar:e.jsx(Ys,{sidebarSearch:m,setSidebarSearch:b,selectedLevel:a,setSelectedLevel:o}),content:e.jsxs(e.Fragment,{children:[e.jsx(Ts,{selectedLevel:a,setSelectedLevel:o}),!D&&e.jsx(Vs,{}),g&&e.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative",children:g}),e.jsx(Bs,{registrationNumber:n,setRegistrationNumber:l,handleSearch:d}),e.jsx(Os,{results:D?F:null,selectedYear:t,selectedLevel:a,loading:I})]})})]})},jt=r.forwardRef(({className:t,...s},a)=>e.jsx("div",{className:"relative w-full overflow-auto",children:e.jsx("table",{ref:a,className:x("w-full caption-bottom text-sm",t),...s})}));jt.displayName="Table";const Nt=r.forwardRef(({className:t,...s},a)=>e.jsx("thead",{ref:a,className:x("[&_tr]:border-b",t),...s}));Nt.displayName="TableHeader";const vt=r.forwardRef(({className:t,...s},a)=>e.jsx("tbody",{ref:a,className:x("[&_tr:last-child]:border-0",t),...s}));vt.displayName="TableBody";const Hs=r.forwardRef(({className:t,...s},a)=>e.jsx("tfoot",{ref:a,className:x("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...s}));Hs.displayName="TableFooter";const ce=r.forwardRef(({className:t,...s},a)=>e.jsx("tr",{ref:a,className:x("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s}));ce.displayName="TableRow";const yt=r.forwardRef(({className:t,...s},a)=>e.jsx("th",{ref:a,className:x("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s}));yt.displayName="TableHead";const q=r.forwardRef(({className:t,...s},a)=>e.jsx("td",{ref:a,className:x("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s}));q.displayName="TableCell";const _s=r.forwardRef(({className:t,...s},a)=>e.jsx("caption",{ref:a,className:x("mt-4 text-sm text-muted-foreground",t),...s}));_s.displayName="TableCaption";const Js=({headers:t})=>e.jsx(Nt,{children:e.jsx(ce,{children:t.map((s,a)=>e.jsx(yt,{className:"text-left",children:s},a))})}),St=({students:t})=>{const[s,a]=r.useState(null),[o,n]=r.useState(!1),[l,m]=r.useState(null),[b,D]=r.useState(1),[N,F]=r.useState(5),y=(f,O)=>{a(f),m(O),n(!0)},I=["Student Name","Registration","Total Marks","Assigned School","Allocated Combination","Reason"],L=Math.ceil(t.length/N),g=(b-1)*N,c=g+N,d=t.slice(g,c),S=()=>{b<L&&D(b+1)},w=()=>{b>1&&D(b-1)},A=f=>{F(Number(f.target.value)),D(1)};return e.jsxs("div",{className:"border rounded-md",children:[e.jsxs(jt,{children:[e.jsx(Js,{headers:I}),e.jsx(vt,{children:t.length===0?e.jsx(ce,{children:e.jsx(q,{colSpan:6,className:"text-center h-32 text-muted-foreground",children:"No students distributed yet."})}):d.map((f,O)=>e.jsxs(ce,{className:"hover:bg-gray-50",children:[e.jsx(q,{children:f.name}),e.jsx(q,{children:f.registrationNumber}),e.jsx(q,{children:f.totalMarks||"N/A"}),e.jsx(q,{children:f.assignedSchool||"No match"}),e.jsx(q,{children:f.allocatedCombinations||"N/A"}),e.jsx(q,{children:e.jsx(z,{variant:"outline",size:"sm",onClick:()=>y(f.explanation||"No explanation available",f.name),children:"View Reason"})})]},O))})]}),t.length>0&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-700",children:"Rows per page:"}),e.jsxs("select",{value:N,onChange:A,className:"p-1 text-sm border rounded",children:[e.jsx("option",{value:5,children:"5"}),e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:50,children:"50"})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",b," of ",L||1]}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(z,{variant:"outline",size:"sm",onClick:w,disabled:b===1,children:e.jsx(is,{className:"w-4 h-4"})}),e.jsx(z,{variant:"outline",size:"sm",onClick:S,disabled:b===L||L===0,children:e.jsx(cs,{className:"w-4 h-4"})})]})]})]}),e.jsx(me,{open:o,onOpenChange:n,children:e.jsxs(oe,{className:"max-w-md",children:[e.jsx(ue,{children:e.jsxs(le,{children:["Assignment Explanation for ",l]})}),e.jsx("div",{className:"mt-4 text-sm",children:s})]})})]})},Z=({children:t,isLoading:s=!1,disabled:a=!1,onClick:o,...n})=>e.jsx(z,{onClick:o,disabled:s||a,...n,children:s?e.jsx(pe,{}):t}),Gs=De("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),wt=r.forwardRef(({className:t,...s},a)=>e.jsx(tt,{ref:a,className:x(Gs(),t),...s}));wt.displayName=tt.displayName;const Ct=r.createContext(null),kt=fs,Qs=t=>e.jsx(Ct.Provider,{value:{name:t.name},children:e.jsx(gs,{...t})}),fe=()=>{const t=r.useContext(Ct),s=r.useContext(Dt),{getFieldState:a,formState:o}=ps();if(!t)throw new Error("useFormField should be used within <FormField>");const n=a(t.name,o);return{id:(s==null?void 0:s.id)??"",name:t.name,formItemId:`${(s==null?void 0:s.id)??""}-form-item`,formDescriptionId:`${(s==null?void 0:s.id)??""}-form-item-description`,formMessageId:`${(s==null?void 0:s.id)??""}-form-item-message`,...n}},Dt=r.createContext(null),Lt=r.forwardRef(({className:t,...s},a)=>{const o=r.useId();return e.jsx(Dt.Provider,{value:{id:o},children:e.jsx("div",{ref:a,className:x("space-y-2",t),...s})})});Lt.displayName="FormItem";const Rt=r.forwardRef(({className:t,...s},a)=>{const{error:o,formItemId:n}=fe();return e.jsx(wt,{ref:a,className:x(o&&"text-red-500 dark:text-red-900",t),htmlFor:n,...s})});Rt.displayName="FormLabel";const $t=r.forwardRef(({...t},s)=>{const{error:a,formItemId:o,formDescriptionId:n,formMessageId:l}=fe();return e.jsx(Je,{ref:s,id:o,"aria-describedby":a?`${n} ${l}`:`${n}`,"aria-invalid":!!a,...t})});$t.displayName="FormControl";const Ws=r.forwardRef(({className:t,...s},a)=>{const{formDescriptionId:o}=fe();return e.jsx("p",{ref:a,id:o,className:x("text-[0.8rem] text-gray-500 dark:text-gray-400",t),...s})});Ws.displayName="FormDescription";const Ks=r.forwardRef(({className:t,children:s,...a},o)=>{const{error:n,formMessageId:l}=fe(),m=n?String((n==null?void 0:n.message)??""):s;return m?e.jsx("p",{ref:o,id:l,className:x("text-[0.8rem] font-medium text-red-500 dark:text-red-900",t),...a,children:m}):null});Ks.displayName="FormMessage";const de=({name:t,label:s,options:a,control:o,placeholder:n})=>e.jsx(Qs,{control:o,name:t,render:({field:l})=>e.jsxs(Lt,{children:[e.jsx(Rt,{children:s}),e.jsx($t,{children:e.jsxs(ee,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx(K,{children:e.jsx(te,{placeholder:n||`Select ${s}`})}),e.jsx(X,{children:a.map(m=>e.jsx(B,{value:m.value,children:m.label},m.value))})]})})]})}),Xs=W.object({year:W.string().min(4,"Year is required"),level:W.string().min(1,"Level is required")}),Ee=({onImport:t,title:s="Import Data",description:a="Upload an Excel file containing data"})=>{const[o,n]=r.useState(!1),[l,m]=r.useState(null),[b,D]=r.useState(null),N=rt({resolver:nt(Xs),defaultValues:{year:new Date().getFullYear().toString(),level:"O-Level"}}),F=[{value:"2023",label:"2023"},{value:"2024",label:"2024"},{value:"2025",label:"2025"}],y=[{value:"P-Level",label:"Primary"},{value:"O-Level",label:"Secondary"}],I=g=>{var S;const c=(S=g.target.files)==null?void 0:S[0];if(!c)return;D(c.name);const d=new FileReader;d.onload=w=>{var A;try{const f=(A=w.target)==null?void 0:A.result,O=bs(f,{type:"binary"}),T=O.SheetNames[0],V=O.Sheets[T],U=ie.sheet_to_json(V);m(U)}catch(f){console.error("Error parsing Excel file:",f),m(null)}},d.readAsBinaryString(c)},L=g=>{l&&l.length>0&&(t(l,g.year,g.level),n(!1),N.reset(),m(null),D(null))};return e.jsxs(e.Fragment,{children:[e.jsxs(Z,{variant:"outline",onClick:()=>n(!0),className:"gap-2",children:[e.jsx(Se,{className:"text-green-700",size:16}),s]}),e.jsx(me,{open:o,onOpenChange:n,children:e.jsxs(oe,{className:"sm:max-w-md",children:[e.jsxs(ue,{children:[e.jsx(le,{children:s}),e.jsx(ht,{children:a})]}),e.jsx(kt,{...N,children:e.jsxs("form",{onSubmit:N.handleSubmit(L),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(de,{name:"year",label:"Academic Year",options:F,control:N.control}),e.jsx(de,{name:"level",label:"Education Level",options:y,control:N.control})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"file-upload",className:"text-sm font-medium",children:"Upload Excel File"}),e.jsx(he,{id:"file-upload",type:"file",accept:".xlsx,.xls,.csv",onChange:I}),b&&e.jsxs("p",{className:"text-sm text-gray-500",children:["Selected file: ",b]}),l&&e.jsxs("p",{className:"text-sm text-green-600",children:[l.length," records found"]})]}),e.jsx(xt,{className:"mt-4",children:e.jsx(Z,{className:"bg-black hover:text-black",type:"submit",disabled:!l||l.length===0,children:"Import"})})]})})]})})]})},It=({data:t,filename:s="distributed-students"})=>{const a=()=>{if(!t||t.length===0)return;const o=ie.json_to_sheet(t),n=ie.book_new();ie.book_append_sheet(n,o,"Students"),js(n,`${s}.xlsx`)};return e.jsxs(Z,{variant:"outline",onClick:a,disabled:!t||t.length===0,className:"gap-2 bg-green-100 text-green-800",children:[e.jsx(ds,{size:16,className:""}),"Export Excel"]})},Zs=W.object({year:W.string().min(4,"Year is required"),level:W.string().min(1,"Level is required")}),ea=({onDistribute:t,onSave:s,onImport:a,onUseTestData:o,isDistributing:n,isSaving:l,distributedStudents:m,importedStudentsCount:b=0,importedSchoolsCount:D=0})=>{const N=rt({resolver:nt(Zs),defaultValues:{year:new Date().getFullYear().toString(),level:"O-Level"}}),F=[{value:"2023",label:"2023"},{value:"2024",label:"2024"},{value:"2025",label:"2025"}],y=[{value:"P-Level",label:"Primary"},{value:"O-Level",label:"Secondary"}],I=()=>{const{year:g,level:c}=N.getValues();t(g,c)},L=()=>{const{year:g,level:c}=N.getValues();s(g,c)};return e.jsx("div",{className:"p-4 border rounded-lg bg-white shadow-sm",children:e.jsxs(kt,{...N,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4",children:[e.jsx(de,{name:"year",label:"Academic Year",options:F,control:N.control}),e.jsx(de,{name:"level",label:"Education Level",options:y,control:N.control}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[b>0&&e.jsxs("span",{className:"mr-3 px-3 py-2 bg-blue-100 text-blue-800 rounded-full text-xs",children:[b," Students"]}),D>0&&e.jsxs("span",{className:"px-3 py-2 bg-green-100 text-green-800 rounded-full text-xs",children:[D," Schools"]})]})})]}),e.jsx("div",{className:"border-primary border w-full my-1"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(Ee,{onImport:(g,c,d)=>a(g,c,d,"students"),title:"Import Students",description:"Upload an Excel file containing student information"}),e.jsx(Ee,{onImport:(g,c,d)=>a(g,c,d,"schools"),title:"Import Schools",description:"Upload an Excel file containing school information"}),e.jsxs(Z,{onClick:o,className:"gap-2 text-black bg-red-200/25",children:[e.jsx(ms,{size:16}),"Get Data Automatically"]}),e.jsx("div",{className:"border-primary border w-full"}),e.jsxs(Z,{onClick:I,disabled:n||b===0&&D===0,className:"gap-2 text-black",children:[n?e.jsx("div",{className:"mt-4",children:e.jsx(pe,{})}):e.jsx(us,{className:"text-green-500 font-bold",size:16}),"Distribute Students"]}),e.jsx(Z,{variant:"outline",onClick:L,disabled:l||m.length===0,className:"gap-2 bg-black text-white",children:l?"save...":"Save Distribution"}),e.jsx(It,{data:m,filename:"student-distribution"})]})]})})},ta=({importedData:t,onCardClick:s})=>t.length===0?null:e.jsx("div",{className:"mt-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.map((a,o)=>e.jsxs(se,{className:"cursor-pointer bg-yellow-500/10  hover:bg-gray-50 transition-colors",onClick:()=>s(a.data,a.type),children:[e.jsx(ae,{className:"pb-2",children:e.jsxs(re,{className:"text-base",children:[a.type==="students"?"Students":"Schools",": ",a.year," ",a.level]})}),e.jsxs(ne,{children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[a.count," ",a.type==="students"?"Students":"Schools"]}),e.jsx(z,{variant:"link",className:"p-0 h-auto mt-2 text-blue-600",onClick:n=>{n.stopPropagation(),s(a.data,a.type)},children:"View Details"})]})]},`${a.type}-${a.year}-${a.level}-${o}`))})}),sa=({title:t,onDistribute:s,onSave:a,onImport:o,onUseTestData:n,isDistributing:l,isSaving:m,distributedStudents:b,importedStudentsCount:D,importedSchoolsCount:N,importedData:F=[]})=>{const[y,I]=r.useState(null),[L,g]=r.useState(!1),c=(d,S,w)=>{I({data:d,type:S,title:w}),g(!0)};return e.jsx("div",{className:"container mx-auto py-6 space-y-6",children:e.jsxs(se,{children:[e.jsx(ae,{className:"pb-3",children:e.jsx(re,{children:t})}),e.jsxs(ne,{children:[e.jsx(ea,{onDistribute:s,onSave:a,onImport:o,onUseTestData:n,isDistributing:l,isSaving:m,distributedStudents:b,importedStudentsCount:D,importedSchoolsCount:N}),F.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Imported Data"}),e.jsx(ta,{importedData:F,onCardClick:c})]}),b.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:"Distributed Students"}),e.jsx(St,{students:b})]}),e.jsx(me,{open:L,onOpenChange:g,children:y&&e.jsxs(oe,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(ue,{children:e.jsxs(le,{children:[y.title||(y.type==="students"?"Students":"Schools")," ","Details"]})}),y.type==="students"?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Name"}),e.jsx("th",{className:"text-left p-2",children:"Registration"}),e.jsx("th",{className:"text-left p-2",children:"Level"}),e.jsx("th",{className:"text-left p-2",children:"Total Marks"})]})}),e.jsx("tbody",{children:y.data.map((d,S)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:d.name}),e.jsx("td",{className:"p-2",children:d.registrationNumber}),e.jsx("td",{className:"p-2",children:d.level}),e.jsx("td",{className:"p-2",children:d.totalMarks})]},S))})]})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"School Name"}),e.jsx("th",{className:"text-left p-2",children:"Level"}),e.jsx("th",{className:"text-left p-2",children:"Status"}),e.jsx("th",{className:"text-left p-2",children:"Capacity"}),e.jsx("th",{className:"text-left p-2",children:"Location"})]})}),e.jsx("tbody",{children:y.data.map((d,S)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:d.name}),e.jsx("td",{className:"p-2",children:d.level}),e.jsx("td",{className:"p-2",children:d.status}),e.jsx("td",{className:"p-2",children:d.capacity}),e.jsx("td",{className:"p-2",children:d.location})]},S))})]})})]})})]})]})})},aa=()=>{const[t,s]=r.useState([]),[a,o]=r.useState([]),[n,l]=r.useState([]),[m,b]=r.useState(!1),[D,N]=r.useState(!1),[F,y]=r.useState(new Date().getFullYear().toString()),[I,L]=r.useState("O-Level"),[g,c]=r.useState(0),[d,S]=r.useState(0),[w,A]=r.useState([]),[f,O]=r.useState([]),[T,V]=r.useState([]),U=new Ns("AIzaSyBhmbMLHWi6vsMyqS6UjOhQT9h9iS8RLmw"),J=h=>h.map(p=>{try{return{...p,scores:typeof p.scores=="string"?JSON.parse(p.scores):p.scores,preference:typeof p.preference=="string"?JSON.parse(p.preference):p.preference,selectedCombinations:typeof p.selectedCombinations=="string"?JSON.parse(p.selectedCombinations):p.selectedCombinations,totalMarks:typeof p.totalMarks=="string"?parseFloat(p.totalMarks):p.totalMarks}}catch(C){return console.error(`Error parsing data for student ${p.name}:`,C),{...p,scores:[],preference:[],selectedCombinations:[],totalMarks:typeof p.totalMarks=="string"?parseFloat(p.totalMarks)||0:p.totalMarks||0}}}),H=async(h,p)=>{const C=`
    # Bulk Student Distribution Task
    Distribute multiple students to appropriate Rwandan schools based on the following information:
    
    ## Students Details
    ${JSON.stringify(h.map(v=>({name:v.name,registrationNumber:v.registrationNumber,individualSubjectMarks:v.scores,totalMarks:v.totalMarks,level:v.level,preferredSchools:v.preference,preferredCombinations:v.selectedCombinations})),null,2)}
    
    ## Task Instructions
    1. Analyze each student's academic performance.
    2. Match students to appropriate schools based on their performance.
    3. Prioritize students' preferred combinations when possible.
    4. Consider school capacity and available slots.
    5. Provide a clear, detailed explanation for each assignment decision.
    
    ## Output Format
    Return a VALID JSON array of objects, ensuring each object contains:
    - studentName
    - registration
    - totalMarks
    - allocatedSchool
    - level
    - allocatedCombinations
    - reason
    `;try{const R=(await U.getGenerativeModel({model:"gemini-2.0-flash"}).generateContent({contents:[{role:"user",parts:[{text:C}]}],generationConfig:{temperature:.2,maxOutputTokens:2e3}})).response.text();console.log("Raw response:",R);const u=R.replace(/```json\n?|```/g,"").trim();let $;try{$=JSON.parse(u)}catch(Y){try{const E=u.match(/\[[\s\S]*\]/);if(E){const P=E[0].replace(/,\s*$/,"");$=JSON.parse(P)}else throw new Error("Cannot extract valid JSON")}catch(E){throw console.error("JSON Parsing Errors:",Y,E),new Error("Failed to parse student allocations")}}if(!Array.isArray($)||$.length===0)throw new Error("Invalid or empty allocations array");return $.length<h.length?(console.warn(`Incomplete allocations: ${$.length} vs ${h.length} students`),h.map((E,P)=>$[P]||{studentName:E.name,registration:E.registrationNumber,totalMarks:E.totalMarks,allocatedSchool:"Default School",level:E.level,allocatedCombinations:[],reason:"Default allocation due to incomplete AI response"})):$}catch(v){return console.error("Error during bulk distribution:",v),h.map(R=>({studentName:R.name,registration:R.registrationNumber,totalMarks:R.totalMarks,allocatedSchool:"Default School",level:R.level,allocatedCombinations:[],reason:"Default allocation due to processing error"}))}},ge=async(h,p)=>{if(!(m||a.length===0)){b(!0);try{const v=J(a).filter(u=>u.level===p);if(v.length===0){M.error(`No students found for ${p} level`),b(!1);return}const j=await H(v,n),R=v.map((u,$)=>({...u,assignedSchool:j[$].allocatedSchool,allocatedCombinations:j[$].allocatedCombinations||[],explanation:j[$].reason}));s(R),y(h),L(p),M.success("Students distributed successfully")}catch(C){console.error("Error distributing students:",C),M.error("Failed to distribute students")}finally{b(!1)}}},be=(h,p)=>{if(m){M.error("Distribution is already in progress");return}if(a.length===0){M.error("No students available to distribute");return}ge(h,p)},je=async(h,p)=>{if(t.length===0){M.error("No distributed students to save");return}N(!0);try{const C={year:h,level:p,distributions:t.map(j=>({...j,name:j.name,registrationNumber:j.registrationNumber,assignedSchool:j.assignedSchool,allocatedCombinations:j.allocatedCombinations,explanation:j.explanation,totalMarks:j.totalMarks}))},v=await Le.post("http://bkyz2-fmaaa-aaaaa-qaaaq-cai.raw.localhost:4943/distribution",C);if(v.data.success)M.success("Distribution saved successfully");else throw new Error(v.data.message||"Failed to save distribution")}catch(C){console.error("Error saving distribution:",C),M.error(C instanceof Error?C.message:"Failed to save distribution")}finally{N(!1)}},Ne=(h,p,C,v)=>{if(!h||h.length===0){M.error(`No ${v} data found in imported file`);return}console.log(h);try{if(v==="students"){const j=h.map((u,$)=>{const Y=u.scores?u.scores.map(E=>({...E,marks:Math.min(E.marks,100)})):[];return{id:u.id||`S${$+1}`,name:u.name||u.Name||"",registrationNumber:u.registrationNumber||u.Registration||`REG${$+1}`,scores:Y,totalMarks:Math.min(Number(u["Total Marks"]||u.TotalMarks||0),600),level:u.level||C,preference:u.preference||[],selectedCombinations:u.selectedCombinations||null,allocatedCombinations:null}});o(j),c(j.length);const R={type:"students",year:p,level:C,count:j.length,data:j};V(u=>[...u,R]),M.success(`Imported ${j.length} students for ${p} - ${C}`)}else{const j=h.map((u,$)=>({id:u.id||`SCH${$+1}`,name:u["School Name"]||u.Name||"",status:u.Status||"normal",level:u.Level||"O-Level",combinations:u.combinations||[],capacity:Number(u.capacity||300),location:u.Location||"",code:u.code||`${$+1e3}`,availableSlots:u.availableSlots||100,otherSchoolDetails:u.otherSchoolDetails||{}}));l(j),S(j.length);const R={type:"schools",year:p,level:C,count:j.length,data:j};V(u=>[...u,R]),M.success(`Imported ${j.length} schools for ${p}`)}y(p),L(C)}catch(j){console.error(`Error processing imported ${v} data:`,j),M.error(`Failed to process imported ${v} data`)}},i=()=>{const h=(u,$)=>Array.from({length:u},(Y,E)=>{const G=["Mathematics","English","Science","Physics","Chemistry","Biology","Geography","History"].slice(0,6).map(Q=>({course:Q,marks:Math.floor(Math.random()*60)+40})),ve=G.reduce((Q,{marks:ye})=>Q+ye,0);return{id:`S${E+1}`,name:`Student ${E+1}`,registrationNumber:`REG${1e4+E}`,scores:G,totalMarks:ve,level:$,preference:["School A","School B","School C"],selectedCombinations:$==="O-Level"?[{combinationName:"PCM",school:"School A"},{combinationName:"PCB",school:"School B"}]:null,allocatedCombinations:null}}),p=()=>{const u=["Primary","O-Level","A-Level","TVET"],$=["excellent","good","normal","daily"],Y=["PCM","PCB","MCB","MEG","HEG","LFK","MPC"];return Array.from({length:10},(E,P)=>{const G=u[P%4],ve=Y.reduce((Q,ye)=>(Q[ye]={totalSlots:50,remainingSlots:50-Math.floor(Math.random()*20)},Q),{});return{id:`SCH${P+1}`,name:`School ${String.fromCharCode(65+P)}`,status:$[P%4],level:G,combinations:G==="A-Level"?Y.slice(0,3):[],capacity:300+P*50,location:`District ${Math.floor(P/3)+1}`,code:`${1e3+P}`,availableSlots:G==="A-Level"?ve:100}})},C=h(11,"P-Level"),v=h(11,"O-Level"),j=p(),R=[...C,...v];o(R),l(j),c(R.length),S(j.length),V([{type:"students",year:F,level:"P-Level",count:C.length,data:C},{type:"students",year:F,level:"O-Level",count:v.length,data:v},{type:"schools",year:F,level:"All",count:j.length,data:j}]),M.success("Test data loaded successfully")};return e.jsx(sa,{title:"Student Distribution",onDistribute:be,onSave:je,onImport:Ne,onUseTestData:i,isDistributing:m,isSaving:D,distributedStudents:t,importedStudentsCount:g,importedSchoolsCount:d,importedData:T})};var ke=(t=>(t.PRIMARY="P-Level",t.SECONDARY="O-Level",t))(ke||{});const ra=()=>{const t=new Date().getFullYear().toString(),s=ke.SECONDARY,[a,o]=r.useState([]),[n,l]=r.useState([]),[m,b]=r.useState(()=>Array.from({length:5},(i,h)=>(t-h).toString())),[D,N]=r.useState([]),[F,y]=r.useState(!1),[I,L]=r.useState(null),[g,c]=r.useState(t),[d,S]=r.useState(s),[w,A]=r.useState(null),[f,O]=r.useState(""),[T,V]=r.useState(null);r.useEffect(()=>{(async()=>{y(!0),L(null);try{const h=await Le.get(`http://bkyz2-fmaaa-aaaaa-qaaaq-cai.raw.localhost:4943/distribution/${g}/${d}`);h.data.success?(o(h.data.data.distributions),l(h.data.data.distributions),V(h.data.data.lastUpdated)):L(`No distributions found for ${g}, ${d}`)}catch(h){console.error("Error fetching distribution data:",h),L(`Failed to load distribution for ${g}, ${d}`)}finally{y(!1)}})()},[g,d]),r.useEffect(()=>{if(a.length>0){const i=Array.from(new Set(a.map(h=>h.assignedSchool))).filter(Boolean).sort();N(i)}else N([])},[a]),r.useEffect(()=>{if(a.length>0){let i=[...a];w?i=i.filter(h=>h.assignedSchool===w):f&&(i=i.filter(h=>{var p;return(p=h.assignedSchool)==null?void 0:p.toLowerCase().includes(f.toLowerCase())})),l(i)}else l([])},[a,w,f]);const U=n.map(i=>({id:i.id,name:i.name,registrationNumber:i.registrationNumber,level:i.level,assignedSchool:i.assignedSchool,allocatedCombinations:i.allocatedCombinations||[],explanation:i.explanation,totalMarks:i.totalMarks,createdAt:i.createdAt})),J=n.map(i=>({Name:i.name,"Registration Number":i.registrationNumber,"Total Marks":i.totalMarks,"Assigned School":i.assignedSchool,"Allocated Combinations":i.allocatedCombinations||"",Explanation:i.explanation||""})),H=i=>{A(i==="all-schools"?null:i),O("")},ge=i=>{O(i.target.value),A(null)},be=()=>{if(n.length===0)return;const h=[["Name","Registration Number","Total Marks","Assigned School","Allocated Combinations","Explanation"].join(","),...n.map(R=>{var u;return[`"${R.name}"`,R.registrationNumber,R.totalMarks,`"${R.assignedSchool}"`,`"${R.allocatedCombinations||""}"`,`"${(u=R.explanation)==null?void 0:u.replace(/"/g,'""')}"`].join(",")})].join(`
`),p=new Blob([h],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(p),v=document.createElement("a");v.setAttribute("href",C);const j=w?`-${w.replace(/\s+/g,"-")}`:f?"-school-filter":"";v.setAttribute("download",`distributions-${g}-${d}${j}.csv`),v.style.visibility="hidden",document.body.appendChild(v),v.click(),document.body.removeChild(v)},je=()=>{const i=`distributions-${g}-${d}`;return w?`${i}-${w.replace(/\s+/g,"-")}`:f?`${i}-school-filter`:i},Ne=i=>i?new Date(i).toLocaleString():"";return e.jsxs(se,{className:"p-0",children:[e.jsxs(ae,{className:"pb-0",children:[e.jsx(re,{className:"text-xl md:text-2xl",children:"Student Distribution Results"}),e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx("div",{children:e.jsxs(ee,{value:g,onValueChange:i=>{c(i),A(null),O("")},children:[e.jsx(K,{className:"w-full",children:e.jsx(te,{placeholder:"Select Year"})}),e.jsx(X,{children:m.map(i=>e.jsx(B,{value:i,children:i},i))})]})}),e.jsx("div",{children:e.jsxs(ee,{value:d,onValueChange:i=>{S(i),A(null),O("")},children:[e.jsx(K,{className:"w-full",children:e.jsx(te,{placeholder:"Select Level"})}),e.jsx(X,{children:Object.values(ke).map(i=>e.jsx(B,{value:i,children:i},i))})]})}),e.jsx("div",{children:e.jsxs(ee,{value:w||"all-schools",onValueChange:H,children:[e.jsx(K,{className:"w-full",children:e.jsx(te,{placeholder:"Filter by School"})}),e.jsxs(X,{children:[e.jsx(B,{value:"all-schools",children:"All Schools"}),D.map(i=>e.jsx(B,{value:i,children:i},i))]})]})}),e.jsx("div",{children:e.jsx(he,{placeholder:"Search schools...",value:f,onChange:ge,className:"w-full"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-2 mt-4",children:[T&&e.jsxs("div",{className:"text-sm rounded-full px-4 bg-green-100 text-black order-2 sm:order-1",children:["Last updated: ",Ne(T)]}),e.jsxs("div",{className:"flex justify-center gap-2 order-1 sm:order-2",children:[e.jsxs(z,{onClick:be,disabled:n.length===0,className:"gap-2 bg-black",children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"CSV"})]}),e.jsx(It,{data:J,filename:je()})]})]})]})]}),e.jsx(ne,{className:"pt-4 overflow-x-auto",children:F?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("p",{children:"Loading distributions..."})}):I?e.jsx("div",{className:"flex justify-center items-center h-64 text-center",children:e.jsx("p",{className:"text-red-500",children:I})}):e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-2 text-sm text-gray-500",children:[n.length," students found",w?` in ${w}`:"",f?` matching "${f}"`:""]}),e.jsx("div",{className:"overflow-x-auto -mx-4 sm:mx-0",children:e.jsx("div",{className:"min-w-full inline-block align-middle px-4 sm:px-0",children:e.jsx(St,{students:U})})})]})})]})},na=[{path:"/",element:vs,protected:!1,children:[{path:"",element:qs,protected:!1}]},{path:"/portal",element:Ms,protected:!0,children:[{path:"distributed",element:ra,protected:!0},{path:"locate",element:aa,protected:!0}]}],oa=["/","/login"],Me=({children:t})=>{const{isAuthenticated:s,loading:a}=xe(),o=Pe();return a?e.jsx("div",{children:"Loading..."}):s&&oa.includes(o.pathname)?e.jsx(ze,{to:"/portal",replace:!0}):e.jsx(e.Fragment,{children:t})},Oe=({children:t,path:s})=>{const{isAuthenticated:a,userData:o,loading:n}=xe(),l=Pe();return n?e.jsx(pe,{}):a?s==="/portal"&&l.pathname==="/portal"?e.jsx(e.Fragment,{children:t}):e.jsx(e.Fragment,{children:t}):e.jsx(ze,{to:"/",state:{from:l},replace:!0})},la=()=>e.jsx(Mt,{children:e.jsx(As,{children:e.jsxs("main",{className:"overflow-x-hidden",children:[e.jsx(Ot,{children:na.map((t,s)=>e.jsx(Ie,{path:t.path,element:t.protected?e.jsx(Oe,{path:t.path,children:e.jsx(t.element,{})}):e.jsx(Me,{children:e.jsx(t.element,{})}),children:t.children&&t.children.map((a,o)=>e.jsx(Ie,{path:a.path,element:a.protected?e.jsx(Oe,{path:a.path,children:e.jsx(a.element,{})}):e.jsx(Me,{children:e.jsx(a.element,{})})},o))},s))}),e.jsx(hs,{})]})})});At(document.getElementById("root")).render(e.jsx(r.StrictMode,{children:e.jsx(la,{})}));
